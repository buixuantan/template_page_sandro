define(['Magento_Customer/js/customer-data','Magento_Ui/js/lib/core/class','underscore'],function(customerData,Class,_){'use strict';return Class.extend({customerDataKey:'google-tag-manager-product-info',initialize:function(){this._super();var productInfo=customerData.get(this.customerDataKey);productInfo.subscribe(this.onDataChange,this);},onDataChange:function(productInfo){if(!_.isEmpty(productInfo)&&!_.isEmpty(productInfo.data)&&!_.isEmpty(productInfo.data.products)){var result=productInfo.data;if(result['products']['added_item_data']){this.reportAddedProducts(result['products']['added_item_data'],result['currencyCode']);}
if(result['products']['removed_item_data']){this.reportRemovedProducts(result['products']['removed_item_data'],result['currencyCode']);}
customerData.set(this.customerDataKey,{});}},reportAddedProducts:function(products,currencyCode){var eventType='addToCart',actionType='add';this.pushEvent(eventType,actionType,products,currencyCode);},reportRemovedProducts:function(products,currencyCode){var eventType='removeFromCart',actionType='remove';this.pushEvent(eventType,actionType,products,currencyCode);},pushEvent:function(eventType,actionType,products,currencyCode){var eventData={'event':eventType,'ecommerce':{'currencyCode':currencyCode}};eventData['ecommerce'][actionType]={'products':products};window.dataLayer=window.dataLayer||[];window.dataLayer.push(eventData);}});});